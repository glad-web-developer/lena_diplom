{% extends 'core/base.html' %}


{% block Content %}

    <div class="container-fluid">
        <div class="row">

            <div class="mb-3 col-12 col-xl-2 col-md-3 col-sm-4 col-lg-2">
                <div class="list-group list-group-item-success " id="list-tab" role="tablist">
                    {% for danie in nabor %}
                        <a class="list-group-item  list-group-item-action {% if forloop.first %} active{% endif %}"
                           id="list-home-list{{ danie.id }}"
                           data-toggle="list"
                           href="#list-home{{ danie.id }}" role="tab">{{ danie }} ({{ danie.tip }}) </a>
                    {% endfor %}
                </div>

            </div>
            <div class="col-12 col-xl-10 col-md-9 col-sm-8 col-lg-10">
                <div class="tab-content" id="nav-tabContent">
                    {% for danie in nabor %}

                        <div class="tab-pane fade {% if forloop.first %}show active{% endif %}"
                             id="list-home{{ danie.id }}" role="tabpanel"
                             aria-labelledby="list-home-list{{ danie.id }}">
                            <div class="row">


                                <div class="col-12">
                                    <h5 class="text-center mb-4">{{ danie.name }} ({{ danie.tip }})</h5>
                                </div>
                                <div class="col-12 col-xl-7 col-md-6 col-sm-6 col-lg-7">
                                    <table class="table table-bordered text-center table-responsive  small">
                                        <tr>
                                            <th>n ˗ период</th>
                                            <th>q ˗ количество товара</th>
                                            <th>p ˗ цена</th>
                                            <th>c ˗ удельная стоимость производства</th>
                                            <th>a(n,r) ˗ коэффициент дисконтирования</th>
                                            <th>d ˗ негативное воздействие</th>
                                            <th>e ˗ объем загрязнения</th>
                                            <th>δ ˗ доля накопленного загрязняющего вещества</th>
                                            <th>r ˗ ставка дисконтирования</th>
                                            <th>t ˗ начальный момент времени</th>
                                            <th>f ˗ инвестиции в расширение производства</th>
                                            {% if danie.tip == 'B4 и Alpha' %}
                                                <th class="table-success">b4 - величина выгод</th>
                                                <th class="table-success">alpha - граница привлекательности инвестиций
                                                </th>
                                            {% endif %}
                                            {% if danie.tip == 'B3 и Beta' %}
                                                <th class="table-danger">b3 ˗ величина выгод</th>
                                                <th class="table-danger">beta - граница привлекательности инвестиций
                                                </th>
                                            {% endif %}
                                        </tr>
                                        {% for i in danie.parametri.all %}
                                            <tr>
                                                <td>{{ i.period }}</td>
                                                <td>{{ i.kol_vo_tovara }}</td>
                                                <td>{{ i.price }}</td>
                                                <td>{{ i.udelnaia_stoimost_proizvodstva }}</td>
                                                <td>{{ i.get_koefizent_discontirovania }}</td>
                                                <td>{{ i.negativ_vozdeistvia_na_obshestvo }}</td>
                                                <td>{{ i.obiem_zagriaz_veshestv }}</td>
                                                <td>{{ i.dolia_nackoplenia_zagr_vechesatv }}</td>
                                                <td>{{ i.stavka_diskontirovania }}</td>
                                                <td>{{ i.nachalnii_moment_vremeni }}</td>
                                                <td>{{ i.investizii_v_rashirenie_proizvodstva }}</td>
                                                {% if danie.tip == 'B4 и Alpha' %}
                                                    <td>{{ i.get_b4 }}</td>
                                                    <td>{{ i.get_alpha }}</td>
                                                {% endif %}
                                                {% if danie.tip == 'B3 и Beta' %}
                                                    <td>{{ i.get_velichina_vigod }}</td>
                                                    <td>{{ i.get_graniza_privlekatelnosti }}</td>
                                                {% endif %}

                                            </tr>
                                        {% endfor %}
                                    </table>
                                </div>
                                <div class="col-12 col-xl-5 col-md-6 col-sm-6 col-lg-5">
                                    {% if danie.tip == 'B4 и Alpha' %}
                                        <canvas id="grafic_alpha{{ forloop.counter }}"
                                                class="w-100 border bg-white py-3"
                                                height="300"></canvas>

                                        <script>
                                            $(function () {


                                                var config_diograma_obrazovanie = {
                                                    type: 'line',
                                                    data: {
                                                        datasets: [{
                                                            data: [
                                                                {% for i in danie.parametri.all %} {{ i.str_alpha }} ,{% endfor %}],
                                                            label: 'Alpha',
                                                            steppedLine: 'true',
                                                            borderColor: '#28a745',
                                                            fill: false
                                                        }],

                                                        labels: [
                                                            {% for i in danie.parametri.all %} '' ,{% endfor %}]
                                                    },
                                                    options: {
                                                        responsive: true,
                                                        title: {
                                                            display: true,
                                                            text: '{{ danie.get_title_param }}'
                                                        },
                                                        scales: {
                                                            xAxes: [{
                                                                ticks: {
                                                                    // Include a dollar sign in the ticks
                                                                    callback: function (value, index, values) {
                                                                        let a = [
                                                                            {% for i in danie.parametri.all %} '{{ i.get_str_dlua_postroenia }}' ,{% endfor %}]
                                                                        return a[index];
                                                                    }
                                                                }
                                                            }]
                                                        },

                                                        tooltips: {
                                                            mode: 'index',
                                                            callbacks: {
                                                                // Use the footer callback to display the sum of the items showing in the tooltip
                                                                footer: function (tooltipItems, data, index) {
                                                                    var sum = 0;
                                                                    let a = [
                                                                        {% for i in danie.parametri.all %} `{{ i.get_spisok_vsex_tchek }}` ,{% endfor %}];

                                                                    return a[tooltipItems[0].index]
                                                                },
                                                            },
                                                        },

                                                    }
                                                };


                                                var ctx_diograma_obrazovanie = document.getElementById("grafic_alpha{{ forloop.counter }}").getContext('2d');
                                                new Chart(ctx_diograma_obrazovanie, config_diograma_obrazovanie);


                                            });


                                        </script>
                                    {% endif %}
                                    {% if danie.tip == 'B3 и Beta' %}

                                        <canvas id="grafic_beta{{ forloop.counter }}" class="w-100 border bg-white py-3"
                                                height="300"></canvas>

                                        <script>
                                            $(function () {


                                                var config_diograma_obrazovanie = {
                                                    type: 'line',
                                                    data: {
                                                        datasets: [{
                                                            data: [
                                                                {% for i in danie.parametri.all %} {{ i.get_graniza_privlekatelnosti }} ,{% endfor %}],
                                                            label: 'Beta',
                                                            steppedLine: 'true',
                                                            borderColor: '#a7282c',
                                                            fill: false
                                                        }],

                                                        labels: [
                                                            {% for i in danie.parametri.all %} '' ,{% endfor %}]
                                                    },
                                                  options: {
                                                        responsive: true,
                                                        title: {
                                                            display: true,
                                                            text: '{{ danie.get_title_param }}'
                                                        },
                                                        scales: {
                                                            xAxes: [{
                                                                ticks: {
                                                                    // Include a dollar sign in the ticks
                                                                    callback: function (value, index, values) {
                                                                        let a = [
                                                                            {% for i in danie.parametri.all %} '{{ i.get_str_dlua_postroenia }}' ,{% endfor %}]
                                                                        return a[index];
                                                                    }
                                                                }
                                                            }]
                                                        },

                                                        tooltips: {
                                                            mode: 'index',
                                                            callbacks: {
                                                                // Use the footer callback to display the sum of the items showing in the tooltip
                                                                footer: function (tooltipItems, data, index) {
                                                                    var sum = 0;
                                                                    let a = [
                                                                        {% for i in danie.parametri.all %} `{{ i.get_spisok_vsex_tchek }}` ,{% endfor %}];

                                                                    return a[tooltipItems[0].index]
                                                                },
                                                            },
                                                        },

                                                    }
                                                };


                                                var ctx_diograma_obrazovanie = document.getElementById("grafic_beta{{ forloop.counter }}").getContext('2d');
                                                new Chart(ctx_diograma_obrazovanie, config_diograma_obrazovanie);


                                            });


                                        </script>
                                    {% endif %}
                                </div>

                            </div>

                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>







{% endblock %}